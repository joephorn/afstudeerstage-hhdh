<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>interactie demo</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.js"></script>
    <style>
      :root {
        --bg: #f8fafc;
        --panel: #ffffff;
        --text: #0f172a;
        --muted: #64748b;
        --accent: #2563eb;
        --border: #e2e8f0;
        --control-bg: #ffffff;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        color: var(--text); background: var(--bg);
      }
      header { padding: 14px 14px 0; }
      h1 { margin: 0; font-size: 16px; font-weight: 650; color: var(--text); }
      .toolbar {
        display: flex; flex-wrap: wrap; gap: 10px 16px; align-items: center;
        padding: 12px 14px; background: var(--panel); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
      }
      label { display: inline-flex; align-items: center; gap: 8px; color: var(--muted); }
      select, input[type="range"], button {
        appearance: none; border: 1px solid var(--border); background: var(--control-bg); color: var(--text);
        border-radius: 0; padding: 6px 10px; height: 34px;
      }
      input[type="range"] { width: 160px; height: 6px; padding: 0; accent-color: var(--accent); }
      .panel { display: inline-flex; gap: 14px; align-items: center; }
      .hidden { display: none !important; }
      .value { color: var(--text); min-width: 36px; text-align: right; }
      main { padding: 14px; }
      #canvasWrap { position: relative; max-width: 100%; margin: 0 auto; }
      #hint {
        position: absolute; left: 8px; bottom: 8px; padding: 6px 8px; border-radius: 6px;
        background: rgba(2, 6, 23, 0.06); color: #0f172a; font-size: 12px; pointer-events: none; border: 1px solid var(--border); border-radius: 0;
      }
    </style>
  </head>
  <body>
    <div class="toolbar">
      <label>
        Interactie
        <select id="mode">
          <option value="live" selected>Live (muis)</option>
          <option value="sliders">Sliders</option>
          <option value="random">Random</option>
          <option value="presets">Presets</option>
        </select>
      </label>

      <label>
        Vorm
        <select id="shape">
          <option value="circle" selected>Cirkel</option>
          <option value="rect">Rechthoek</option>
          <option value="triangle">Driehoek</option>
        </select>
      </label>

      <div id="slidersPanel" class="panel hidden">
        <label>Grootte <span id="sizeOut" class="value">60</span><input id="size" type="range" min="5" max="220" step="1" value="60"></label>
        <label>Rotatie <span id="rotOut" class="value">0°</span><input id="rotation" type="range" min="-180" max="180" step="1" value="0"></label>
        <label>Variatie <span id="variationOut" class="value">30%</span><input id="variation" type="range" min="0" max="100" step="1" value="30"></label>
        <label>Beweging <span id="motionOut" class="value">30°</span><input id="motion" type="range" min="0" max="180" step="1" value="30"></label>
        <label>Grad hoek <span id="gangleOut" class="value">45°</span><input id="gangle" type="range" min="-180" max="180" step="1" value="45"></label>
        <label>Grad hard <span id="ghardOut" class="value">50%</span><input id="ghard" type="range" min="0" max="100" step="1" value="50"></label>
        <label>Zwart aandeel <span id="gblackOut" class="value">60%</span><input id="gblack" type="range" min="0" max="100" step="1" value="60"></label>
        <label>Streak breedte <span id="streakWOut" class="value">12%</span><input id="streakW" type="range" min="0" max="40" step="1" value="12"></label>
      </div>

      <div id="randomPanel" class="panel hidden">
        <button id="randomize">Randomize</button>
      </div>

      <div id="presetsPanel" class="panel hidden">
        <label>Preset
          <select id="presetSelect">
            <option value="rustig">Rustig grid</option>
            <option value="sterren">Felle punten</option>
            <option value="driehoeken">Draaiende driehoeken</option>
            <option value="stokjes">Stokjes</option>
            <option value="minimal">Minimal (licht, subtiel)</option>
            <option value="candy">Candy (fel, zacht)</option>
            <option value="mono">Mono (grijstinten)</option>
            <option value="spin">Spin (langzame rotatie)</option>
            <option value="mixbasic">Mix basic (cirkel+rechthoek)</option>
            <option value="mixpointy">Mix pointy (driehoek)</option>
            <option value="checker">Checker mix</option>
            <option value="diagwave">Diag wave</option>
            <option value="rings">Rings</option>
            <option value="pastel">Pastel</option>
            <option value="warm">Warm</option>
            <option value="cool">Cool</option>
          </select>
        </label>
      </div>
    </div>

    <main>
      <div id="canvasWrap">
        <div id="hint">Live: beweeg je muis over het canvas</div>
      </div>
    </main>

    <script>
      // ——— UI state
      const elMode = document.getElementById('mode');
      const elShape = document.getElementById('shape');
      const elSliders = document.getElementById('slidersPanel');
      const elRandom = document.getElementById('randomPanel');
      const elPresets = document.getElementById('presetsPanel');
      const elPresetSelect = document.getElementById('presetSelect');
      const elHint = document.getElementById('hint');

      // Slider elements
      const elSize = document.getElementById('size');
      const elRot = document.getElementById('rotation');
      const elVariation = document.getElementById('variation');
      const elMotion = document.getElementById('motion');
      const elGAngle = document.getElementById('gangle');
      const elGHard = document.getElementById('ghard');
      const elGBlack = document.getElementById('gblack');
      const elStreakW = document.getElementById('streakW');
      const outSize = document.getElementById('sizeOut');
      const outRot = document.getElementById('rotOut');
      const outVariation = document.getElementById('variationOut');
      const outMotion = document.getElementById('motionOut');
      const outGAngle = document.getElementById('gangleOut');
      const outGHard = document.getElementById('ghardOut');
      const outGBlack = document.getElementById('gblackOut');
      const outStreakW = document.getElementById('streakWOut');

      const params = {
        mode: 'live',
        shape: 'circle',
        size: 60,
        rotation: 0,   // degrees
        varAmount: 30, // 0..100%
        motion: 30,    // rotatie wobble amplitude in graden
        gradAngle: 45, // gradient richting
        gradHard: 50,  // 0..100% hard edge
        gradBlack: 60, // % van de vorm die zwart is
        streakWidth: 12, // % van canvasbreedte
      };

      const presets = {
        rustig:     { shape: 'circle',   size: 64, rotation: 0,  varAmount: 20, motion: 10, gradAngle: 30,  gradHard: 30, gradBlack: 60 },
        sterren:    { shape: 'triangle', size: 40, rotation: 0,  varAmount: 35, motion: 15, gradAngle: 60,  gradHard: 60, gradBlack: 55 },
        driehoeken: { shape: 'triangle', size: 72, rotation: 0,  varAmount: 45, motion: 50, gradAngle: 90,  gradHard: 40, gradBlack: 65 },
        stokjes:    { shape: 'rect',     size: 24, rotation: 90, varAmount: 15, motion:  0, gradAngle: 0,   gradHard: 70, gradBlack: 70 },
        minimal:    { shape: 'circle',   size: 52, rotation: 0,  varAmount: 10, motion:  5, gradAngle: 15,  gradHard: 20, gradBlack: 60 },
        candy:      { shape: 'circle',   size: 36, rotation: 0,  varAmount: 30, motion: 20, gradAngle: 45,  gradHard: 50, gradBlack: 50 },
        mono:       { shape: 'rect',     size: 40, rotation: 0,  varAmount: 18, motion:  0, gradAngle: 120, gradHard: 80, gradBlack: 65 },
        spin:       { shape: 'triangle', size: 60, rotation: 0,  varAmount: 20, motion: 35, gradAngle: 180, gradHard: 40, gradBlack: 55 },
        mixbasic:   { shape: 'circle',   size: 64, rotation: 0,  varAmount: 20, motion: 20, gradAngle: 20,  gradHard: 30, gradBlack: 60, mixShapes:['circle','rect'] },
        mixpointy:  { shape: 'triangle', size: 60, rotation: 0,  varAmount: 25, motion: 25, gradAngle: 70,  gradHard: 50, gradBlack: 60, mixShapes:['triangle'] },
        checker:    { shape: 'rect',     size: 56, rotation: 0,  varAmount: 25, motion: 10, gradAngle: 0,   gradHard: 85, gradBlack: 70, pattern:'checker', mixShapes:['circle','rect'] },
        diagwave:   { shape: 'circle',   size: 52, rotation: 0,  varAmount: 35, motion: 60, gradAngle: 45,  gradHard: 30, gradBlack: 55, pattern:'diag' },
        rings:      { shape: 'circle',   size: 40, rotation: 0,  varAmount: 20, motion: 40, gradAngle: 135, gradHard: 40, gradBlack: 60, pattern:'rings' },
        pastel:     { shape: 'circle',   size: 48, rotation: 0,  varAmount: 15, motion: 10, gradAngle: 20,  gradHard: 25, gradBlack: 55 },
        warm:       { shape: 'rect',     size: 52, rotation: 0,  varAmount: 22, motion: 10, gradAngle: -20, gradHard: 70, gradBlack: 65 },
        cool:       { shape: 'triangle', size: 56, rotation: 0,  varAmount: 22, motion: 15, gradAngle: 100, gradHard: 60, gradBlack: 60 }
      };

      function applyParams(obj){
        Object.assign(params, obj);
        // reflect to UI when sliders visible
        elShape.value = params.shape;
        elSize.value = params.size; outSize.textContent = params.size;
        elRot.value = params.rotation; outRot.textContent = Math.round(params.rotation) + '°';
        elVariation.value = params.varAmount; outVariation.textContent = params.varAmount + '%';
        elMotion.value = params.motion; outMotion.textContent = Math.round(params.motion) + '°';
        elGAngle.value = params.gradAngle; outGAngle.textContent = Math.round(params.gradAngle) + '°';
        elGHard.value = params.gradHard; outGHard.textContent = Math.round(params.gradHard) + '%';
        elGBlack.value = params.gradBlack; outGBlack.textContent = Math.round(params.gradBlack) + '%';
        elStreakW.value = params.streakWidth; outStreakW.textContent = Math.round(params.streakWidth) + '%';
      }

      function randomize(){
        const shapes = ['circle','rect','triangle'];
        applyParams({
          shape: shapes[Math.floor(Math.random()*shapes.length)],
          size: Math.floor(20 + Math.random()*160),
          rotation: Math.floor(-90 + Math.random()*180),
          varAmount: Math.floor(Math.random()*80),
          motion: Math.floor(Math.random()*120),
          gradAngle: Math.floor(-180 + Math.random()*360),
          gradHard: Math.floor(Math.random()*100),
          gradBlack: Math.floor(30 + Math.random()*60),
          streakWidth: Math.floor(5 + Math.random()*20),
        });
      }

      // ——— p5 sketch
      let pgWidth = 960, pgHeight = 540;
      const H_PACK = 1.0; // gelijke horizontale en verticale spacing
      let t = 0; // time for animations

      function setup(){
        const wrap = document.getElementById('canvasWrap');
        const c = createCanvas(10, 10);
        c.parent(wrap);
        angleMode(DEGREES);
        colorMode(HSB, 360, 100, 100, 1);
        noFill();
        noStroke();
        resizeToParent();
        pixelDensity(1);
      }

      function windowResized(){ resizeToParent(); }

      function resizeToParent(){
        const wrap = document.getElementById('canvasWrap');
        const top = wrap.getBoundingClientRect().top;
        const availH = Math.max(220, Math.floor(window.innerHeight - top - 16));
        const w = Math.floor(wrap.clientWidth);
        pgWidth = Math.max(320, w);
        pgHeight = availH; // geen vaste aspect ratio → past in scherm
        resizeCanvas(pgWidth, pgHeight);
      }

      // Live interactie extra state (boven draw gebruiken)
      const liveDrag = { active:false, lastX:0, lastY:0, rotOffset:0 };
      const liveWheel = { sizeOffset: 0 };

      function draw(){
        // Witte/off-white canvas, vast
        background(0, 0, 100);
        noStroke();
        t += deltaTime / 1000;

        // Bepaal effectieve parameters
        const eff = getEffectiveParams();

        // geen lijnen/stroke

        const cols = 6;
        const rows = 6;
        const cellW = width / (cols + 1);
        const cellH = height / (rows + 1);
        for (let gy = 1; gy <= rows; gy++){
          for (let gx = 1; gx <= cols; gx++){
            const baseX = gx * cellW;
            const x = (width/2) + (baseX - width/2) * H_PACK;
            const y = gy * cellH;
            const u = (gx-1) / (cols-1);
            const v = (gy-1) / (rows-1);
            // Variaties per cel
            const n = noise(gx*0.6, gy*0.6, t*0.4); // 0..1
            const varAmt = eff.varAmount / 100;     // 0..1
            const sizeMul = lerp(1.0, lerp(0.75, 1.25, n), varAmt);
            const wob = sin(t*50 + gx*35 + gy*22);  // -1..1
            const rot = eff.rotation + wob * eff.motion + (liveDrag.rotOffset||0)*0.2;
            // kleur weg — fill is altijd zwart (gradient)
            push();
            translate(x, y);
            const effCellW = cellW * H_PACK;
            const R = Math.min(effCellW, cellH) * 0.48; // veilige radius tot celranden
            const baseS = eff.size + (liveWheel.sizeOffset||0);
            let s = Math.max(6, baseS) * sizeMul;
            // Clamp per vorm, zodat niets afgesneden wordt (rekening houdend met rotatie)
            const shapeClamp = (shape) => {
              // gegeven toegestane radius R, bereken max s
              if (shape === 'circle') return 2 * R;
              if (shape === 'rect')   return Math.SQRT2 * R;     // s/√2 <= R
              if (shape === 'triangle') return 1.2 * R;          // (s/1.2) <= R
              return 2 * R;
            };
            // kies lokale vorm (mix/patronen kunnen variëren)
            let shapeLocal = eff.shape;
            if (Array.isArray(eff.mixShapes) && eff.mixShapes.length){
              shapeLocal = eff.mixShapes[(gx + gy) % eff.mixShapes.length];
            }
            s = Math.min(s, shapeClamp(shapeLocal));
            // preset combinaties: mix shapes/patronen
            if (eff.pattern === 'checker'){
              const alt = ((gx + gy) % 2) ? 0.85 : 1.15;
              drawShape(shapeLocal, s * alt, rot, eff.gradAngle);
            } else if (eff.pattern === 'diag'){
              const k = (gx - gy);
              drawShape(shapeLocal, s, rot + k * 6, eff.gradAngle);
            } else if (eff.pattern === 'rings'){
              const cx = (cols + 1) / 2; const cy = (rows + 1) / 2;
              const rr = Math.hypot(gx - cx, gy - cy);
              drawShape(shapeLocal, s * (1 + 0.06 * sin(t*40 + rr*12)), rot + rr * 8, eff.gradAngle);
            } else {
              drawShape(shapeLocal, s, rot, eff.gradAngle);
            }
            // witte streak overlay bij Live: band rond mouseX
            if (params.mode === 'live'){
              const bw = width * (Math.max(0, eff.streakWidth) / 100); // bandbreedte
              const d = Math.abs(x - mouseX);
              const k = Math.exp(- (d*d) / (2 * bw*bw)); // 0..1
              if (k > 0.01){
                blendMode(ADD);
                noStroke();
                // elliptische highlight binnen vorm
                fill(0, 0, 100, Math.min(0.6, 0.8 * k));
                const hs = s * (0.45 + 0.2 * k);
                drawShapeSolid(shapeLocal, hs, rot);
                blendMode(BLEND);
              }
            }
            pop();
          }
        }
      }

      function getEffectiveParams(){
        const eff = { ...params };
        if (params.mode === 'live'){
          // Zelfde grid; muis stuurt meerdere parameters
          eff.size = constrain(map(mouseX, 0, width, 20, 200), 20, 200);
          const rel = (mouseX - width/2) / (width/2);
          eff.rotation = rel * 60; // -60 .. 60 voor subtiliteit
          // Variatie en beweging via afstand tot midden en Y
          const d = min(1, dist(mouseX, mouseY, width/2, height/2) / (min(width, height)/2));
          eff.varAmount = d * 100;
          eff.motion = map(mouseY, 0, height, 0, 120);
          // Stuur gradient richting en streak-breedte live mee
          eff.gradAngle = eff.rotation;
          eff.streakWidth = map(mouseY, 0, height, 6, 24);
          elHint.textContent = 'Live: beweeg (X/Y), sleep (rotatie/kleurshift), scroll = zoom';
        } else if (params.mode === 'random'){
          elHint.textContent = 'Random: klik op Randomize voor variaties';
        } else if (params.mode === 'presets'){
          elHint.textContent = 'Presets: kies een stijl';
        } else {
          elHint.textContent = 'Sliders: pas de waarden aan';
        }
        return eff;
      }

      function drawShape(shape, size, rot, gradAngle){
        push();
        rotate(rot);
        // Zwarte gradient fill + donkere stroke via Canvas API
        const ctx = drawingContext;
        const a = (Number(gradAngle)||0) * Math.PI/180;
        const dx = Math.cos(a) * size * 0.5;
        const dy = Math.sin(a) * size * 0.5;
        const grad = ctx.createLinearGradient(-dx, -dy, dx, dy);
        // zachtere overgang: breedte afhankelijk van gradHard (0..100)
        const hard = Math.max(0, Math.min(1, (Number(params.gradHard)||0)/100));
        const width = 0.6 * (1 - hard) + 0.1; // 0.7..0.1 overgangsbreedte
        const bal = Math.max(0, Math.min(1, (Number(params.gradBlack)||0)/100));
        const center = 0.1 + 0.8 * bal;       // 0.1 .. 0.9
        const t0 = Math.max(0, center - width/2);
        const t1 = Math.min(1, center + width/2);
        grad.addColorStop(0.0, 'rgba(0,0,0,1)');
        grad.addColorStop(t0, 'rgba(0,0,0,1)');
        grad.addColorStop(t1, 'rgba(255,255,255,1)');
        grad.addColorStop(1.0, 'rgba(255,255,255,1)');
        ctx.fillStyle = grad;
        ctx.beginPath();
        if (shape === 'circle'){
          ctx.arc(0, 0, size/2, 0, Math.PI*2);
        } else if (shape === 'rect'){
          ctx.rect(-size/2, -size/2, size, size);
        } else if (shape === 'triangle'){
          const r = size/1.2;
          ctx.moveTo(cos(0)*r, sin(0)*r);
          for (let a2 = 120; a2 < 360; a2 += 120){ ctx.lineTo(cos(a2)*r, sin(a2)*r); }
          ctx.closePath();
        }
        ctx.fill();
        pop();
      }

      function polygon(x, y, radius, n){
        beginShape();
        for (let a = 0; a < 360; a += 360/n){
          const vx = x + cos(a) * radius;
          const vy = y + sin(a) * radius;
          vertex(vx, vy);
        }
        endShape(CLOSE);
      }

      function drawShapeSolid(shape, size, rot){
        push();
        rotate(rot);
        if (shape === 'circle'){
          ellipse(0, 0, size, size);
        } else if (shape === 'rect'){
          rectMode(CENTER);
          rect(0, 0, size, size);
        } else if (shape === 'triangle'){
          const r = size/1.2;
          polygon(0, 0, r, 3);
        }
        pop();
      }

      

      // ——— Live extra interactie: drag + mouse wheel
      function mousePressed(){
        if (params.mode !== 'live') return;
        liveDrag.active = true;
        liveDrag.lastX = mouseX; liveDrag.lastY = mouseY;
      }
      function mouseDragged(){
        if (!liveDrag.active || params.mode !== 'live') return;
        const dx = mouseX - liveDrag.lastX;
        liveDrag.rotOffset += dx * 0.6;          // horizontale sleep → extra rotatie
        liveDrag.lastX = mouseX; liveDrag.lastY = mouseY;
      }
      function mouseReleased(){ liveDrag.active = false; }
      function mouseWheel(e){
        if (params.mode !== 'live') return;
        liveWheel.sizeOffset += -e.delta * 0.2; // scroll omhoog = groter
        liveWheel.sizeOffset = constrain(liveWheel.sizeOffset, -200, 400);
        return false; // voorkom pagina scroll
      }

      // ——— Wire up UI
      function updatePanels(){
        elSliders.classList.toggle('hidden', params.mode !== 'sliders');
        elRandom.classList.toggle('hidden', params.mode !== 'random');
        elPresets.classList.toggle('hidden', params.mode !== 'presets');
      }

      elMode.addEventListener('change', () => {
        params.mode = elMode.value;
        updatePanels();
        if (params.mode === 'random') randomize();
        if (params.mode === 'presets') applyParams(presets[elPresetSelect.value]);
      });
      elShape.addEventListener('change', () => { params.shape = elShape.value; });

      // Sliders
      function bindRange(el, outKey, key, fmt){
        const out = document.getElementById(outKey);
        function set(){ params[key] = Number(el.value); out.textContent = fmt ? fmt(params[key]) : params[key]; }
        el.addEventListener('input', set); set();
      }
      bindRange(elSize, 'sizeOut', 'size');
      bindRange(elRot, 'rotOut', 'rotation', v => Math.round(v) + '°');
      bindRange(elVariation, 'variationOut', 'varAmount', v => Math.round(v) + '%');
      bindRange(elMotion, 'motionOut', 'motion', v => Math.round(v) + '°');
      bindRange(elGAngle, 'gangleOut', 'gradAngle', v => Math.round(v) + '°');
      bindRange(elGHard, 'ghardOut', 'gradHard', v => Math.round(v) + '%');
      bindRange(elGBlack, 'gblackOut', 'gradBlack', v => Math.round(v) + '%');
      bindRange(elStreakW, 'streakWOut', 'streakWidth', v => Math.round(v) + '%');

      // Random
      document.getElementById('randomize').addEventListener('click', randomize);

      // Presets
      elPresetSelect.addEventListener('change', () => {
        const p = presets[elPresetSelect.value];
        applyParams(p);
      });

      // Initialize
      updatePanels();
      applyParams(params);
    </script>
  </body>
  </html>
